import os
import re

# Define the directory containing your images
FOLDER_PATH = 'photosFix'  # Update this if using an absolute path

# List of known image extensions to clean (can expand if needed)
BAD_EXTENSIONS = ['.jpg', '.jpeg', '.webp', '.jfif', '.heic', '.bmp', '.tiff', '.gif']

def sanitize_filename(filename):
    # Split the filename from its full path
    name, ext = os.path.splitext(filename)
    
    # Remove ALL bad extensions chained onto the base name
    while any(name.lower().endswith(bad_ext) for bad_ext in BAD_EXTENSIONS + ['.png']):
        for bad_ext in BAD_EXTENSIONS:
            if name.lower().endswith(bad_ext):
                name = name[: -len(bad_ext)]
        # Allow loop to clear out multiple chained extensions like '.png.jpg.webp'

    # Return clean name + correct extension
    return name + '.png'

def rename_files(folder_path):
    if not os.path.exists(folder_path):
        print(f"‚ùå Folder not found: {folder_path}")
        return
    
    files = os.listdir(folder_path)
    if not files:
        print("üìÇ Folder is empty.")
        return

    rename_count = 0

    for file in files:
        file_path = os.path.join(folder_path, file)
        if os.path.isfile(file_path):
            new_name = sanitize_filename(file)
            new_path = os.path.join(folder_path, new_name)
            
            # Avoid overwriting existing files
            if new_path != file_path and not os.path.exists(new_path):
                os.rename(file_path, new_path)
                rename_count += 1
                print(f"‚úÖ Renamed: {file} ‚Üí {new_name}")
            elif new_path == file_path:
                print(f"‚è≠Ô∏è  Skipped (already clean): {file}")
            else:
                print(f"‚ö†Ô∏è  Conflict: {new_name} already exists ‚Äî skipping.")
    
    print(f"\n‚úîÔ∏è Done. {rename_count} files renamed.")

if __name__ == '__main__':
    rename_files(FOLDER_PATH)